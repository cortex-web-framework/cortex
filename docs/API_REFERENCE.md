# CLI Extensibility API Reference

## Overview

This document provides a comprehensive reference for the Cortex CLI Extensibility System APIs.

## Core Interfaces

### CortexPlugin

The main plugin interface that all plugins must implement.

```typescript
interface CortexPlugin {
  name: string;
  version: string;
  description: string;
  commands: CLICommand[];
  templates: Template[];
  hooks: Hook[];
}
```

**Properties:**
- `name` (string): Unique plugin identifier
- `version` (string): Plugin version (semver)
- `description` (string): Human-readable description
- `commands` (CLICommand[]): Array of CLI commands
- `templates` (Template[]): Array of templates
- `hooks` (Hook[]): Array of event hooks

### CLICommand

Represents a CLI command that can be executed.

```typescript
interface CLICommand {
  name: string;
  description: string;
  action: (args: string[], options: Record<string, unknown>) => Promise<void>;
  options?: readonly CLIOption[] | undefined;
  subcommands?: CLICommand[] | undefined;
}
```

**Properties:**
- `name` (string): Command name
- `description` (string): Command description
- `action` (function): Command implementation
- `options` (CLIOption[]): Command options
- `subcommands` (CLICommand[]): Nested commands

### CLIOption

Defines a command-line option.

```typescript
interface CLIOption {
  name: string;
  alias?: string;
  type: 'string' | 'number' | 'boolean' | 'array';
  description: string;
  required?: boolean;
  default?: unknown;
  choices?: readonly string[];
  validation?: ValidationRule[];
}
```

**Properties:**
- `name` (string): Option name
- `alias` (string): Short option name
- `type` (string): Option type
- `description` (string): Option description
- `required` (boolean): Whether option is required
- `default` (unknown): Default value
- `choices` (string[]): Allowed values
- `validation` (ValidationRule[]): Validation rules

### Template

Represents a template that can generate files.

```typescript
interface Template {
  name: string;
  description: string;
  files: TemplateFile[];
  variables: TemplateVariable[];
}
```

**Properties:**
- `name` (string): Template name
- `description` (string): Template description
- `files` (TemplateFile[]): Template files
- `variables` (TemplateVariable[]): Template variables

### TemplateFile

Defines a file to be generated by a template.

```typescript
interface TemplateFile {
  path: string;
  content: string;
}
```

**Properties:**
- `path` (string): File path (supports variables)
- `content` (string): File content (supports Handlebars syntax)

### TemplateVariable

Defines a variable used in templates.

```typescript
interface TemplateVariable {
  name: string;
  type: 'string' | 'number' | 'boolean' | 'array' | 'object';
  required: boolean;
  description: string;
  default?: unknown;
  validation?: ValidationRule[];
}
```

**Properties:**
- `name` (string): Variable name
- `type` (string): Variable type
- `required` (boolean): Whether variable is required
- `description` (string): Variable description
- `default` (unknown): Default value
- `validation` (ValidationRule[]): Validation rules

### Hook

Represents an event hook that can be triggered.

```typescript
interface Hook {
  name: string;
  event: string;
  handler: (context: HookContext) => Promise<void>;
}
```

**Properties:**
- `name` (string): Hook name
- `event` (string): Event name
- `handler` (function): Hook implementation

### HookContext

Context object passed to hook handlers.

```typescript
interface HookContext {
  hookName: string;
  event: string;
  command?: string | undefined;
  args?: readonly string[] | undefined;
  options?: Record<string, unknown> | undefined;
  workingDirectory: string;
  logger: PluginLogger;
  data: Record<string, unknown>;
}
```

**Properties:**
- `hookName` (string): Name of the hook
- `event` (string): Event that triggered the hook
- `command` (string): Command being executed
- `args` (string[]): Command arguments
- `options` (object): Command options
- `workingDirectory` (string): Current working directory
- `logger` (PluginLogger): Logger instance
- `data` (object): Additional data

## Registry Interfaces

### PluginRegistry

Manages plugin registration and discovery.

```typescript
interface PluginRegistry {
  register(plugin: CortexPlugin): void;
  unregister(name: string): void;
  get(name: string): CortexPlugin | undefined;
  getAll(): CortexPlugin[];
  find(commandName: string): CLICommand | undefined;
}
```

### TemplateRegistry

Manages template registration and discovery.

```typescript
interface TemplateRegistry {
  register(template: Template): void;
  unregister(name: string): void;
  get(name: string): Template | undefined;
  getAll(): Template[];
  find(pattern: string): Template[];
}
```

### HookRegistry

Manages hook registration and execution.

```typescript
interface HookRegistry {
  register(hook: Hook): void;
  unregister(name: string): void;
  get(name: string): Hook | undefined;
  getAll(): Hook[];
  execute(event: string, context: HookContext): Promise<void>;
}
```

## Loader Interfaces

### PluginLoader

Loads and validates plugins.

```typescript
interface PluginLoader {
  loadPlugin(filePath: string): Promise<CortexPlugin>;
  loadPlugins(directory: string): Promise<CortexPlugin[]>;
  validatePlugin(plugin: CortexPlugin): ValidationResult;
}
```

### TemplateEngine

Renders templates with variables.

```typescript
interface TemplateEngine {
  render(template: string, variables: Record<string, unknown>): string;
  renderFile(template: Template, variables: Record<string, unknown>): Promise<TemplateFile[]>;
  validateTemplate(template: Template): ValidationResult;
}
```

## Security Interfaces

### SecuritySandbox

Provides isolated execution environments.

```typescript
interface SecuritySandbox {
  execute(code: string, options: SandboxOptions): Promise<SandboxResult>;
  validatePolicy(policy: SecurityPolicy): ValidationResult;
  getResourceUsage(): ResourceUsage;
}
```

### SecurityPolicy

Defines security constraints.

```typescript
interface SecurityPolicy {
  maxMemory: number;
  maxExecutionTime: number;
  allowedModules: string[];
  deniedModules: string[];
  allowedFileOperations: string[];
  deniedFileOperations: string[];
}
```

## Performance Interfaces

### PerformanceOptimizer

Optimizes plugin and template performance.

```typescript
interface PerformanceOptimizer {
  optimizePlugin(plugin: CortexPlugin): Promise<OptimizedPlugin>;
  optimizeTemplate(template: Template): Promise<OptimizedTemplate>;
  enableCaching(type: 'templates' | 'plugins' | 'all'): void;
  disableCaching(type: 'templates' | 'plugins' | 'all'): void;
  getMetrics(): PerformanceMetrics;
}
```

### OptimizedPlugin

Represents an optimized plugin.

```typescript
interface OptimizedPlugin {
  plugin: CortexPlugin;
  optimizations: string[];
  performanceGain: number;
  memoryUsage: number;
  loadTime: number;
}
```

## GitHub Integration

### GitHubInstaller

Installs plugins from GitHub repositories.

```typescript
interface GitHubInstaller {
  installFromGitHub(repository: string): Promise<GitHubInstallResult>;
  searchPlugins(query: string): Promise<GitHubPlugin[]>;
  getPluginInfo(repository: string): Promise<GitHubPluginInfo>;
}
```

### GitHubPlugin

Represents a plugin available on GitHub.

```typescript
interface GitHubPlugin {
  name: string;
  repository: string;
  description: string;
  stars: number;
  downloads: number;
  lastUpdated: Date;
  license: string;
}
```

## Validation Interfaces

### ValidationResult

Result of validation operations.

```typescript
interface ValidationResult {
  valid: boolean;
  errors: ValidationError[];
  warnings: ValidationWarning[];
}
```

### ValidationError

Represents a validation error.

```typescript
interface ValidationError {
  type?: string;
  field: string;
  message: string;
  code: string;
}
```

### ValidationRule

Defines validation rules.

```typescript
interface ValidationRule {
  type: 'required' | 'minLength' | 'maxLength' | 'pattern' | 'custom';
  value?: unknown;
  message?: string;
  validator?: (value: unknown) => boolean;
}
```

## Logger Interfaces

### PluginLogger

Logger interface for plugins.

```typescript
interface PluginLogger {
  debug(message: string, ...args: unknown[]): void;
  info(message: string, ...args: unknown[]): void;
  warn(message: string, ...args: unknown[]): void;
  error(message: string, ...args: unknown[]): void;
}
```

## Utility Types

### MemoryUsage

Memory usage information.

```typescript
interface MemoryUsage {
  rss: number;
  heapTotal: number;
  heapUsed: number;
  external: number;
  arrayBuffers: number;
}
```

### PerformanceMetrics

Performance metrics data.

```typescript
interface PerformanceMetrics {
  performance: {
    totalTime: number;
    averageTime: number;
    operations: number;
    errors: number;
  };
  memory: {
    peak: number;
    current: number;
    allocated: number;
  };
  cache: {
    hits: number;
    misses: number;
    hitRate: number;
  };
  operations: {
    commands: number;
    templates: number;
    hooks: number;
  };
  errors: {
    count: number;
    types: Record<string, number>;
  };
  warnings: {
    count: number;
    types: Record<string, number>;
  };
}
```

## Error Types

### CLIError

Base error class for CLI operations.

```typescript
class CLIError extends Error {
  constructor(message: string, code: string);
  code: string;
}
```

### ValidationError

Error thrown during validation.

```typescript
class ValidationError extends CLIError {
  constructor(message: string, field: string);
  field: string;
}
```

### SecurityError

Error thrown by security sandbox.

```typescript
class SecurityError extends CLIError {
  constructor(message: string, policy: string);
  policy: string;
}
```

## Constants

### Event Names

```typescript
const EVENTS = {
  BEFORE_COMMAND: 'before:command',
  AFTER_COMMAND: 'after:command',
  BEFORE_TEMPLATE: 'before:template',
  AFTER_TEMPLATE: 'after:template',
  BEFORE_HOOK: 'before:hook',
  AFTER_HOOK: 'after:hook',
  PLUGIN_LOADED: 'plugin:loaded',
  PLUGIN_UNLOADED: 'plugin:unloaded',
  ERROR: 'error'
} as const;
```

### Option Types

```typescript
const OPTION_TYPES = {
  STRING: 'string',
  NUMBER: 'number',
  BOOLEAN: 'boolean',
  ARRAY: 'array'
} as const;
```

### Template Variable Types

```typescript
const VARIABLE_TYPES = {
  STRING: 'string',
  NUMBER: 'number',
  BOOLEAN: 'boolean',
  ARRAY: 'array',
  OBJECT: 'object'
} as const;
```

## Usage Examples

### Basic Plugin

```typescript
import { CortexPlugin } from '@cortex/cli/extensibility';

const plugin: CortexPlugin = {
  name: 'my-plugin',
  version: '1.0.0',
  description: 'My custom plugin',
  commands: [],
  templates: [],
  hooks: []
};
```

### Command with Options

```typescript
import { CLICommand } from '@cortex/cli/extensibility';

const command: CLICommand = {
  name: 'my-command',
  description: 'My custom command',
  options: [
    {
      name: 'name',
      alias: 'n',
      type: 'string',
      description: 'Name parameter',
      required: true
    }
  ],
  action: async (args, options) => {
    console.log('Hello,', options['name']);
  }
};
```

### Template with Variables

```typescript
import { Template } from '@cortex/cli/extensibility';

const template: Template = {
  name: 'my-template',
  description: 'My custom template',
  files: [
    {
      path: '{{outputPath}}/{{name}}.ts',
      content: 'export class {{name}} {}'
    }
  ],
  variables: [
    {
      name: 'name',
      type: 'string',
      required: true,
      description: 'Class name'
    },
    {
      name: 'outputPath',
      type: 'string',
      required: false,
      default: '.',
      description: 'Output directory'
    }
  ]
};
```

### Hook Implementation

```typescript
import { Hook } from '@cortex/cli/extensibility';

const hook: Hook = {
  name: 'my-hook',
  event: 'before:command',
  handler: async (context) => {
    console.log('Command about to execute:', context.command);
  }
};
```

## Best Practices

1. **Type Safety**: Always use TypeScript for type safety
2. **Error Handling**: Implement proper error handling
3. **Validation**: Validate all inputs and outputs
4. **Documentation**: Document all public APIs
5. **Testing**: Write comprehensive tests
6. **Security**: Use security sandbox for untrusted code
7. **Performance**: Optimize for performance
8. **Logging**: Use structured logging
9. **Versioning**: Follow semantic versioning
10. **Compatibility**: Maintain backward compatibility